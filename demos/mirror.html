<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
    	body {
    	    margin: 0;
            padding: 0;
        }
    </style>
 </head>
<body>
    <!-- dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/paul-caron/EpicCanvas@v2.0.0-beta-28/epiccanvas.js" crossorigin='anonymous'></script>
    <script src="https://cdn.jsdelivr.net/gh/paul-caron/EpicCanvas@v2.0.0-beta-28/primitives/sphere.js" crossorigin='anonymous'></script>
    <script src="https://cdn.jsdelivr.net/gh/paul-caron/EpicCanvas@v2.0.0-beta-28/primitives/cube.js" crossorigin='anonymous'></script>
   <script src="https://cdn.jsdelivr.net/gh/paul-caron/EpicCanvas@v2.0.0-beta-28/shaders/vertexMirror.js" crossorigin='anonymous'></script>
   <script src="https://cdn.jsdelivr.net/gh/paul-caron/EpicCanvas@v2.0.0-beta-28/shaders/fragmentMirror.js" crossorigin='anonymous'></script>
   <script src="https://cdn.jsdelivr.net/gh/paul-caron/EpicCanvas@v2.0.0-beta-28/shaders/vertexSkybox.js" crossorigin='anonymous'></script>
    <script src="https://cdn.jsdelivr.net/gh/paul-caron/EpicCanvas@v2.0.0-beta-28/shaders/fragmentSkybox.js" crossorigin='anonymous'></script>
<script>
  



// Globals
let sphere, skybox, w, h, epicCanvas, program, program2, cubemap;


const loop = (t) => {
    epicCanvas.clearColor = [0.7, 0.5, 0.8, 1.0];
    epicCanvas.clearScreen();
    epicCanvas.setCubeMap(cubemap);
    epicCanvas.drawShape(program, sphere);
    epicCanvas.setCubeMap(cubemap);
    epicCanvas.drawShape(program2, skybox);
    const error = epicCanvas.gl.getError();
    if (error !== epicCanvas.gl.NO_ERROR) {
        console.error("WebGL error in loop:", error);
    }
    const [x,z] = [Math.cos(t/3000), Math.sin(t/3000)]
    epicCanvas.lookAt([6*x,0,6*z],[0,0,0],[0,1,0])
  
    requestAnimationFrame(loop);
};

const main = async () => {
    try {
        // Create canvas
        const width = w = innerWidth;
        const height = h = innerHeight;
        epicCanvas = new EpicCanvas(width, height, "body");

        // Set up camera
        epicCanvas.lookAt([0, 0, 5], [0, 0, 0], [0, 1, 0]);
        epicCanvas.aspectRatio = w/h;
        epicCanvas.fieldOfView = Math.PI / 3
        
        // Create shader programs
        program = epicCanvas.makeProgram(vsMirror, fsMirror);
        program2 = epicCanvas.makeProgram(vsSkybox, fsSkybox);

        // Create a sphere
        sphere = Sphere(epicCanvas, 55);
 
        // creat skybox
        skybox = Cube(epicCanvas);
        scale(skybox, 50,50,50);
        epicCanvas.reloadBufferData(skybox);
        
        
        // load cube map
        const prefix = "https://raw.githubusercontent.com/paul-caron/EpicCanvas/refs/heads/master/assets/cubemaps/citadella2/";

        const URLs = [
prefix + "posx.jpg",
prefix + "negx.jpg",
prefix + "posy.jpg",
prefix + "negy.jpg",
prefix + "posz.jpg",
prefix + "negz.jpg",
        ];
        cubemap = await epicCanvas.loadCubeMap(URLs);

        // Check for WebGL errors
        const error = epicCanvas.gl.getError();
        if (error !== epicCanvas.gl.NO_ERROR) {
            console.error("WebGL error after initial render:", error);
        }

        // Start the loop
        requestAnimationFrame(loop);
    } catch (e) {
        console.error("Error in main:", e);
    }
};

onload = main;
</script>
</body>
</html>
