<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
 </head>
<body>
    <!-- dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/paul-caron/EpicCanvas@v1.16.25/epiccanvas.js" crossorigin='anonymous'></script>
  <script>
  //simple color shader code strings
const vsSource = `
attribute vec4 aVertexPosition;
attribute vec4 aVertexColor;
uniform mat4 uModelViewMatrix;
uniform mat4 uProjectionMatrix;
uniform float uPointSize;

varying mediump vec4 vColor;
void main(){
    gl_Position=uProjectionMatrix
               *uModelViewMatrix
               *aVertexPosition;
    vColor=aVertexColor;
    gl_PointSize = uPointSize;
}`;

const fsSource = `
varying mediump vec4 vColor;
void main(){
    gl_FragColor=vColor;
}`;

//example of a shape object builder
function square(epicCanvas){
    const vertices=[
        1.0,1.0,0.0,1.0,
        -1.0,1.0,0.0,1.0,
        1.0,-1.0,0.0,1.0,
        -1.0,-1.0,0.0,1.0,
    ]
    const colors=[
        1.0,1.0,1.0,1.0,
        1.0,0.0,0.0,1.0,
        0.0,1.0,0.0,1.0,
        0.0,0.0,1.0,1.0,
    ]
    const textureCoordinates=[
        1.0,0.0,
        0.0,0.0,
        1.0,1.0,
        0.0,1.0,
    ]
    const normals=[
        0.0,0.0,1.0,1.0,
        0.0,0.0,1.0,1.0,
        0.0,0.0,1.0,1.0,
        0.0,0.0,1.0,1.0
    ]
    const mode=epicCanvas.gl.TRIANGLE_STRIP;
    const shape={vertices,colors,textureCoordinates,mode,normals};
    epicCanvas.initBuffers(shape);
    return shape;
}

//globals
let s, model, epicCanvas, program;

//draw loop
const loop = (t) => {
  //rotate model along Y axis
  rotateY(model, 0.01);
  //update the buffered data
  epicCanvas.reloadBufferData(model);
  //clear screen
  epicCanvas.clearScreen();
  //draw
  epicCanvas.drawShape(program, model);
  epicCanvas.drawShape(program, s);
  //loop
  requestAnimationFrame(loop);
}


const main = () => {
  // create canvas
  const width = innerWidth;
  const height = innerHeight;
  epicCanvas = new EpicCanvas(width,height,"body");

  // set clear color and clear the canvas
  epicCanvas.clearColor = [0.7,1.0,1.0,1.0];
  epicCanvas.clearScreen();

  // setup the camera position, lookat center point, up vector.
  epicCanvas.lookAt([0,0,5], [0,0,0], [0,1,0]);

  // create shader program
  program = epicCanvas.makeProgram(vsSource, fsSource);

  // create a simple shape
  s = square(epicCanvas);
  scale(s, 7, 7, 7);
  translateZ(s,-5);
  epicCanvas.reloadBufferData(s);

  epicCanvas.loadPLY("https://cdn.jsdelivr.net/gh/paul-caron/EpicCanvas@master/models/bunny.ply")
  .then(
    (shape) => {
      model = shape;
      //scale the shape within usual bounds
      scaleToUnitSize(shape);
      //scale up 3 times on x,y,z axis
      scale(shape,3,3,3);
      //center the shape in middle of screen
      center(shape);
      //add some colors to the model for the shader to work
      shape.colors = [...(shape.vertices)];
      //reload all buffer attributes
      epicCanvas.reloadBufferData(shape);
      //loop draw
      requestAnimationFrame(loop);
    }
  )
}


onload = main;




  </script>
</body>
</html>
